<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Activities - Barn Gym Retreats</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&family=Raleway:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="retreat-builder.css?v=2">
    <script src="scripts/booking-state.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: url('background-C1rXCpYp.png') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Raleway', sans-serif;
        }

        /* Local specific styles for grid */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 10px 0;
            margin-bottom: 40px;
        }

        .barn-glass-card {
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 150px !important;
        }

        /* Direct selection circle styles */
        .activity-card {
            position: relative;
        }

        .activity-select-trigger {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .activity-card.selected .activity-select-trigger {
            background: var(--color-primary);
            color: white;
            border-color: white;
        }

        .activity-select-trigger:hover {
            transform: scale(1.1);
            background: white;
        }

        .activity-card.selected .activity-select-trigger:hover {
            background: var(--color-primary-dark);
        }

        .activity-select-trigger i {
            font-size: 1.1rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .activity-card.selected .activity-select-trigger i {
            opacity: 1;
        }
    </style>
</head>

<body>

    <div class="barn-glass-card barn-shadow-depth">
        <div class="logo-container">
            <img src="logo-D2Lb8pNx.png" alt="Barn Gym Logo">
        </div>

        <!-- HEADER -->
        <div class="step-hero" style="padding-bottom: 20px;">
            <h2 style="font-size: 2.5rem; margin-bottom: 10px;">Curate Your Experience</h2>
            <p style="font-size: 1.2rem;">Select activities to build your itinerary. Click icons to select instantly, or
                click the card to learn more.</p>
        </div>

        <!-- ACTIVITY GRID -->
        <div id="activities-container" class="activity-grid">
            <!-- Rendered by JS -->
        </div>

        <!-- Sticky Footer (Step 3 of 4) -->
        <div class="sticky-footer visible">
            <div class="footer-content">
                <a href="/details" class="btn btn-secondary">Back</a>
                <div style="text-align: center;">
                    <span id="footer-progress" style="display: block; font-weight: 600;">Step 3 of 4</span>
                    <span id="selected-count" style="font-size: 0.85rem; color: #666;">0 activities selected</span>
                </div>
                <button class="btn" onclick="saveAndNext()">Next: Summary</button>
            </div>
        </div>


    </div>

    <!-- ACTIVITY DETAILS MODAL (Moved to Root) -->
    <div class="modal-overlay" id="activity-modal">
        <div class="modal-card">
            <div class="modal-image-header" id="modal-img">
                <button class="modal-close-btn" onclick="closeModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-body">
                <h3 class="modal-title" id="modal-title">Activity Name</h3>
                <div class="modal-meta">
                    <span id="modal-category">Category</span>
                    <span id="modal-price">£500</span>
                </div>
                <div class="modal-description" id="modal-desc">
                    Description goes here...
                </div>
                <div style="background: #f5f5f5; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                    <h4 style="font-size: 1rem; margin-bottom: 10px;">What's Included:</h4>
                    <ul id="modal-features" style="padding-left: 20px; font-size: 0.9rem; color: #555;">
                        <li>Feature 1</li>
                        <li>Feature 2</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="modal-action-btn" onclick="toggleFromModal()">Add to Retreat</button>
            </div>
        </div>
    </div>

    <script>
        const activitiesDB = [
            {
                id: 'yoga',
                name: 'Morning Yoga',
                category: 'Wellness',
                priceLow: 300,
                priceHigh: 450,
                image: 'Activities/yoga.jpeg',
                description: 'Energize your team with a refreshing morning yoga session. Perfect for all skill levels, focusing on flexibility and mental clarity.',
                features: ['Professional instructor', 'Mats provided', '60-min session']
            },
            {
                id: 'hike',
                name: 'Nature Hike',
                category: 'Adventure',
                priceLow: 250,
                priceHigh: 350,
                image: 'Activities/Country_running.jpeg',
                description: 'Explore local trails with a guided nature hike through the stunning countryside.',
                features: ['Local guide', 'Scenic routes', 'Snacks included']
            },
            {
                id: 'hayball',
                name: 'Hayball Racing',
                category: 'Team Building',
                priceLow: 400,
                priceHigh: 600,
                image: 'Activities/hayball.webp',
                description: 'A signature Barn Gym team challenge. High energy, competitive, and guaranteed laughs.',
                features: ['Team event', 'Safety briefing', 'Trophy for winners']
            },
            {
                id: 'breathwork',
                name: 'Breathwork',
                category: 'Wellness',
                priceLow: 400,
                priceHigh: 550,
                image: 'Activities/Breathwork.jpeg',
                description: 'Master your nervous system with guided breathing techniques for focus and stress relief.',
                features: ['Expert coaching', 'Practical tools', 'Relaxation setup']
            },
            {
                id: 'icebath',
                name: 'Ice Bath Therapy',
                category: 'Wellness',
                priceLow: 500,
                priceHigh: 700,
                image: 'Activities/Ice_bath.jpeg',
                description: 'Build resilience and mental fortitude with guided cold-water immersion.',
                features: ['Coached session', 'Safety protocols', 'Post-dip hot drinks']
            },
            {
                id: 'meditation',
                name: 'Meditation',
                category: 'Wellness',
                priceLow: 350,
                priceHigh: 500,
                image: 'Activities/Meditation.jpeg',
                description: 'Find inner calm and reset the mind with guided mindfulness and meditation.',
                features: ['Quiet setting', 'Guided mindfulness', 'Post-session reflection']
            },
            {
                id: 'pilates',
                name: 'Pilates Class',
                category: 'Fitness',
                priceLow: 350,
                priceHigh: 450,
                image: 'Activities/pilates.jpeg',
                description: 'Strengthen the core and improve posture with a professional-led pilates session.',
                features: ['Core focus', 'Equipment provided', 'All levels']
            },
            {
                id: 'archery',
                name: 'Archery & Axe',
                category: 'Adventure',
                priceLow: 600,
                priceHigh: 850,
                image: 'Activities/archery.webp',
                description: 'Channel your focus with traditional archery and axe throwing competitions.',
                features: ['Safety instructors', 'High-quality gear', 'Scoring system']
            },
            {
                id: 'circuit',
                name: 'Circuit Training',
                category: 'Fitness',
                priceLow: 400,
                priceHigh: 600,
                image: 'Activities/Circuit_training.jpeg',
                description: 'High-intensity team circuit training designed to push your limits together.',
                features: ['Motivating coach', 'Outdoor setup', 'Team relays']
            },
            {
                id: 'cocktail',
                name: 'Cocktail Workshop',
                category: 'Social',
                priceLow: 500,
                priceHigh: 800,
                image: 'Activities/cocktail.webp',
                description: 'Learn the art of mixology from top bartenders in a fun, social environment.',
                features: ['Premium ingredients', 'Drink tastings', 'Take-home recipes']
            },
            {
                id: 'frisbee',
                name: 'Ultimate Frisbee',
                category: 'Social',
                priceLow: 200,
                priceHigh: 300,
                image: 'Activities/frisbee.jpeg',
                description: 'Fast-paced, low-impact fun that encourages communication and movement.',
                features: ['Outdoor field', 'Game coordinator', 'Hydration station']
            },
            {
                id: 'mushroom',
                name: 'Mushroom Foraging',
                category: 'Experience',
                priceLow: 450,
                priceHigh: 650,
                image: 'Activities/mushroom.webp',
                description: 'Discover the hidden gems of the forest with an expert mycologist.',
                features: ['Expert guide', 'Identification kit', 'Seasonal focus']
            },
            {
                id: 'orienting',
                name: 'Orienteering',
                category: 'Team Building',
                priceLow: 300,
                priceHigh: 500,
                image: 'Activities/orienting.jpeg',
                description: 'Navigate complex terrains as a team using only maps and compasses.',
                features: ['Course maps', 'Team challenges', 'Expert debrief']
            },
            {
                id: 'sheep',
                name: 'Sheep Herding',
                category: 'Experience',
                priceLow: 700,
                priceHigh: 1000,
                image: 'Activities/sheep.png',
                description: 'The ultimate communication test. Work with sheepdogs to herd a flock through obstacles.',
                features: ['Working dogs', 'Farming expert', 'Memorable bonding']
            }
        ];

        // Load State
        const state = getBookingState();
        let selectedActivities = new Set(state.activities || []);
        let currentModalId = null;

        function renderActivities() {
            const container = document.getElementById('activities-container');
            container.innerHTML = '';

            activitiesDB.forEach(act => {
                const isSelected = selectedActivities.has(act.name);
                const card = document.createElement('div');
                card.className = `activity-card ${isSelected ? 'selected' : ''}`;
                card.onclick = () => openModal(act.id);

                card.innerHTML = `
                <div class="activity-select-trigger" onclick="toggleSelection(event, '${act.name}')">
                    <i class="fa-solid fa-check"></i>
                </div>
                <div class="activity-img-placeholder" style="background-image: url('${act.image}');"></div>
                <div class="activity-content">
                    <span style="font-size: 1.1rem; display: block; margin-bottom: 5px;">${act.name}</span>
                    <div style="font-size: 0.85rem; color: #666; display: flex; align-items: center; justify-content: center; gap: 5px;">
                        Learn More <i class="fa-solid fa-circle-info" style="color:var(--color-primary);"></i>
                    </div>
                </div>
            `;
                container.appendChild(card);
            });

            document.getElementById('selected-count').innerText = `${selectedActivities.size} activities selected`;
        }

        function toggleSelection(event, name) {
            if (event) event.stopPropagation();
            if (selectedActivities.has(name)) {
                selectedActivities.delete(name);
            } else {
                selectedActivities.add(name);
            }
            renderActivities();
        }

        // Modal Logic
        function openModal(id) {
            currentModalId = id;
            const act = activitiesDB.find(a => a.id === id);
            if (!act) return;

            document.getElementById('modal-img').style.backgroundImage = `url('${act.image}')`;
            document.getElementById('modal-title').innerText = act.name;
            document.getElementById('modal-category').innerText = act.category;
            document.getElementById('modal-price').innerText = `£${act.priceLow} - £${act.priceHigh}`;
            document.getElementById('modal-desc').innerText = act.description;

            const list = document.getElementById('modal-features');
            list.innerHTML = act.features.map(f => `<li>${f}</li>`).join('');

            updateModalButton();
            document.getElementById('activity-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('activity-modal').classList.remove('active');
        }

        function updateModalButton() {
            const act = activitiesDB.find(a => a.id === currentModalId);
            const btn = document.getElementById('modal-action-btn');
            if (selectedActivities.has(act.name)) {
                btn.innerText = "Remove from Retreat";
                btn.classList.add('btn-secondary');
            } else {
                btn.innerText = "Add to Retreat";
                btn.classList.remove('btn-secondary');
            }
        }

        function toggleFromModal() {
            const act = activitiesDB.find(a => a.id === currentModalId);
            if (selectedActivities.has(act.name)) {
                selectedActivities.delete(act.name);
            } else {
                selectedActivities.add(act.name);
            }
            closeModal();
            renderActivities();
        }

        function saveAndNext() {
            saveBookingState({ activities: Array.from(selectedActivities) });
            window.location.href = '/summary';
        }

        // Init
        renderActivities();
    </script>

</body>

</html>

</body>

</html>