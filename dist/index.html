<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Your Perfect Retreat - Barn Gym</title>

    <!-- 1. FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&family=Raleway:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Barn Community Design System - Core Look */
        :root {
            --font-heading: 'Playfair Display', serif;
            --font-body: 'Raleway', sans-serif;
            --color-primary: #017559;
            --color-primary-dark: #015944;
            --color-text-dark: #2d2d2d;
            --color-text-light: #ffffff;

            /* Glass Background Variables */
            --color-card-bg: rgba(255, 255, 255, 0.65);
            --color-card-bg-hover: rgba(255, 255, 255, 0.85);
            --color-border: rgba(255, 255, 255, 0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-body);
            color: var(--color-text-dark);
            background: url('background-C1rXCpYp.png') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* 2. THE BACKGROUND (Glass Effect) */
        .barn-glass-card {
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            position: relative;
            overflow: hidden;
            transition: height 0.3s ease;
        }

        /* 3. THE SHADOWS (3D Depth) */
        .barn-shadow-depth {
            box-shadow:
                0 10px 25px rgba(0, 0, 0, 0.08),
                0 4px 6px rgba(0, 0, 0, 0.04),
                inset 0 1px 1px rgba(255, 255, 255, 0.2);
            transition: box-shadow 300ms ease, transform 300ms ease;
        }

        .barn-shadow-depth:hover {
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.12),
                0 8px 12px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }

        /* General UI Elements */
        h1,
        h2,
        h3,
        h4 {
            font-family: var(--font-heading);
            color: var(--color-primary);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-container img {
            max-width: 120px;
            height: auto;
        }

        .btn {
            display: inline-block;
            background-color: var(--color-primary);
            color: white;
            padding: 14px 32px;
            border-radius: 100px;
            /* Pill shape */
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            margin-top: 20px;
        }

        .btn:hover {
            background-color: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(1, 117, 89, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background-color: rgba(1, 117, 89, 0.1);
        }

        .step-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* STEP 1: HERO */
        .step-hero {
            text-align: center;
            padding: 40px 20px;
        }

        .step-hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .step-hero p {
            font-size: 1.25rem;
            color: #4a4a4a;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        /* STEP 2: LOCATIONS (CAROUSEL) */
        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card-option {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            overflow: hidden;
            cursor: default;
            /* Images are clickable, card selects via button or whole click logic */
            border: 2px solid transparent;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
        }

        .card-option.selected {
            border-color: var(--color-primary);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 4px rgba(1, 117, 89, 0.1);
        }

        /* Carousel Styles */
        .carousel-container {
            position: relative;
            height: 200px;
            /* Taller for better view */
            width: 100%;
            overflow: hidden;
        }

        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: opacity 0.5s ease;
            opacity: 0;
        }

        .carousel-slide.active {
            opacity: 1;
        }

        .carousel-nav {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 10;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background 0.3s;
        }

        .carousel-dot.active {
            background: #fff;
            transform: scale(1.2);
        }

        /* Arrows */
        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9) !important;
            color: var(--color-primary) !important;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0.8 !important;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card-option:hover .carousel-arrow {
            opacity: 1 !important;
        }

        .carousel-arrow:hover {
            background: white !important;
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-prev {
            left: 10px;
        }

        .carousel-next {
            right: 10px;
        }

        /* Gallery Grid */
        .venue-gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .venue-gallery-item {
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .venue-gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .venue-gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }


        .card-content {
            padding: 20px;
            cursor: pointer;
            /* Content area triggers selection */
        }

        .card-content h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .card-content p {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0;
            line-height: 1.5;
        }

        /* STEP 3: DETAILS */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.8);
            font-family: var(--font-body);
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(1, 117, 89, 0.1);
        }

        .flex-row {
            display: flex;
            gap: 20px;
        }

        .flex-col {
            flex: 1;
        }

        /* STEP 4: VISUAL ACTIVITIES */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
        }

        .activity-card {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 16px;
            overflow: hidden;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        /* ACTIVITY IMAGE PLACEHOLDERS - now handled dynamically via inline styles */
        .activity-img-placeholder {
            height: 120px;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .activity-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            /* hidden check */
            transition: all 0.2s;
        }

        .activity-card.selected .activity-overlay {
            background: var(--color-primary);
            color: white;
        }

        .activity-content {
            padding: 12px;
        }

        .activity-content span {
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1rem;
            color: var(--color-text-dark);
        }

        .activity-card.selected {
            border-color: var(--color-primary);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 12px rgba(1, 117, 89, 0.15);
        }

        /* NAVIGATION */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        /* STEP 5: SUMMARY & ITINERARY */
        .summary-box {
            background: rgba(255, 255, 255, 0.5);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .summary-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .summary-thumb {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background-size: cover;
            background-position: center;
        }

        .itinerary-container {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            padding: 15px;
        }

        .day-row {
            margin-bottom: 15px;
            padding-left: 15px;
            border-left: 2px solid var(--color-primary);
        }

        .day-title {
            font-weight: 700;
            color: var(--color-primary);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .day-content {
            font-size: 0.9rem;
            color: #444;
            line-height: 1.5;
        }

        /* MODAL STYLES */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-card {
            background: rgba(255, 255, 255, 0.95);
            width: 90%;
            max-width: 600px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }

        .modal-overlay.active .modal-card {
            transform: scale(1);
        }

        .modal-image-header {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--color-text-dark);
            transition: background 0.2s;
        }

        .modal-close-btn:hover {
            background: white;
        }

        .modal-body {
            padding: 30px;
            overflow-y: auto;
        }

        .modal-title {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            color: var(--color-primary);
            margin-bottom: 10px;
        }

        .modal-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .modal-description {
            font-size: 1rem;
            line-height: 1.6;
            color: #444;
            margin-bottom: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            background: #f9f9f9;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: stretch;
            gap: 15px;
        }

        .modal-footer .btn {
            flex: 1;
            margin: 0;
        }

        /* Step Activities Image Scaling */
        .activity-card:hover .activity-img-placeholder {
            transform: scale(1.1);
        }

        .activity-img-placeholder {
            transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        /* Embed Styles */
        #embed-close-btn {
            display: none;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #333;
        }

        body.is-embedded #embed-close-btn {
            display: flex;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .step-hero h1 {
                font-size: 2.2rem;
            }

            .flex-row {
                flex-direction: column;
                gap: 10px;
            }

            .barn-glass-card {
                padding: 25px;
            }

            .activity-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .carousel-container {
                height: 180px;
            }
        }
    </style>
</head>

<body>

    <div class="barn-glass-card barn-shadow-depth">
        <button id="embed-close-btn" onclick="closeEmbeddedModal()"><i class="fa-solid fa-xmark"></i></button>

        <div class="logo-container">
            <img src="logo-D2Lb8pNx.png" alt="Barn Gym Logo">
        </div>

        <!-- STEP 1: HERO -->
        <div id="step-1" class="step-container active">
            <div class="step-hero">
                <h1>Design Your Custom<br>Corporate Retreat</h1>
                <p>Build a bespoke experience that aligns your team, restores energy, and drives performance. Explore
                    our venues and curate your itinerary.</p>
                <button class="btn" onclick="nextStep(2)">Start Building</button>
            </div>
        </div>

        <!-- STEP 2: LOCATION -->
        <div id="step-2" class="step-container">
            <h2>Select Your Venue</h2>
            <p style="margin-bottom: 20px;">Browse our locations. Swipe images to explore.</p>

            <div class="grid-cards">
                <!-- Location 1: The Bell -->
                <div class="card-option barn-shadow-depth" id="card-bell"
                    onclick="handleCardClick(this, 'The Bell in Ticehurst')">
                    <div class="carousel-container" onmouseover="pauseCarousel('bell')"
                        onmouseout="resumeCarousel('bell')">
                        <div class="carousel-slide active"
                            style="background-image: url('Retreat Images/The Bell/The Bell 1.webp');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/The Bell/The Bell 2.jpg');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/The Bell/The Bell 3 .avif');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/The Bell/The Bell 4.avif');"></div>

                        <button class="carousel-arrow carousel-prev" onclick="moveSlide(event, 'bell', -1)"><i
                                class="fa-solid fa-chevron-left"></i></button>
                        <button class="carousel-arrow carousel-next" onclick="moveSlide(event, 'bell', 1)"><i
                                class="fa-solid fa-chevron-right"></i></button>

                        <div class="carousel-nav" id="nav-bell">
                            <!-- Dots generated by JS -->
                        </div>
                    </div>
                    <div class="card-content">
                        <h3>The Bell Inn</h3>
                        <p>Quirky charm & cozy lodges. Perfect for relaxed strategy & bonding.</p>
                        <button class="learn-more-btn" onclick="event.stopPropagation(); openVenueDetail('bell')"
                            style="display: inline-block; margin-top: 12px; padding: 8px 20px; background: var(--color-primary); color: white; border: none; cursor: pointer; border-radius: 8px; font-weight: 600; font-size: 14px; transition: all 0.3s ease;">Learn
                            More</button>
                    </div>
                </div>

                <!-- Location 2: Eastwood -->
                <div class="card-option barn-shadow-depth" id="card-eastwood"
                    onclick="handleCardClick(this, 'Eastwood Observatory')">
                    <div class="carousel-container" onmouseover="pauseCarousel('eastwood')"
                        onmouseout="resumeCarousel('eastwood')">
                        <div class="carousel-slide active"
                            style="background-image: url('Retreat Images/Eastwood/Eastwood 1.webp');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/Eastwood/Eastwood 2.webp');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/Eastwood/Eastwood 3.webp');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/Eastwood/Eastwood 4.webp');"></div>

                        <button class="carousel-arrow carousel-prev" onclick="moveSlide(event, 'eastwood', -1)"><i
                                class="fa-solid fa-chevron-left"></i></button>
                        <button class="carousel-arrow carousel-next" onclick="moveSlide(event, 'eastwood', 1)"><i
                                class="fa-solid fa-chevron-right"></i></button>

                        <div class="carousel-nav" id="nav-eastwood"></div>
                    </div>
                    <div class="card-content">
                        <h3>Eastwood Observatory</h3>
                        <p>Science meets luxury. High-end facilities with a focus on vision.</p>
                        <button class="learn-more-btn" onclick="event.stopPropagation(); openVenueDetail('eastwood')"
                            style="display: inline-block; margin-top: 12px; padding: 8px 20px; background: var(--color-primary); color: white; border: none; cursor: pointer; border-radius: 8px; font-weight: 600; font-size: 14px; transition: all 0.3s ease;">Learn
                            More</button>
                    </div>
                </div>

                <!-- Location 3: Oastbrook -->
                <div class="card-option barn-shadow-depth" id="card-oast"
                    onclick="handleCardClick(this, 'Oastbrook Vineyards')">
                    <div class="carousel-container" onmouseover="pauseCarousel('oast')"
                        onmouseout="resumeCarousel('oast')">
                        <div class="carousel-slide active"
                            style="background-image: url('Retreat Images/Oastbrook/Oastbrook 1.avif');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/Oastbrook/Oastbrook 2.webp');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/Oastbrook/Oastbrook 3.webp');"></div>
                        <div class="carousel-slide"
                            style="background-image: url('Retreat Images/Oastbrook/Oastbrook 4.webp');"></div>

                        <button class="carousel-arrow carousel-prev" onclick="moveSlide(event, 'oast', -1)"><i
                                class="fa-solid fa-chevron-left"></i></button>
                        <button class="carousel-arrow carousel-next" onclick="moveSlide(event, 'oast', 1)"><i
                                class="fa-solid fa-chevron-right"></i></button>

                        <div class="carousel-nav" id="nav-oast"></div>
                    </div>
                    <div class="card-content">
                        <h3>Oastbrook Vineyards</h3>
                        <p>Immersive vineyard tours & tasting. Great for celebration & connection.</p>
                        <button class="learn-more-btn" onclick="event.stopPropagation(); openVenueDetail('oastbrook')"
                            style="display: inline-block; margin-top: 12px; padding: 8px 20px; background: var(--color-primary); color: white; border: none; cursor: pointer; border-radius: 8px; font-weight: 600; font-size: 14px; transition: all 0.3s ease;">Learn
                            More</button>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep(1)">Back</button>
                <button class="btn" id="btn-loc-next" disabled onclick="nextStep(3)">Select Venue</button>
            </div>
        </div>

        <!-- STEP 3: DETAILS -->
        <div id="step-3" class="step-container">
            <h2>Logistics & Details</h2>
            <p style="margin-bottom: 20px;">Help us understand the scale of your retreat.</p>

            <div class="form-group">
                <label class="form-label">Number of Guests</label>
                <input type="number" class="form-input" id="guest-count" placeholder="e.g. 12" value="12" min="1"
                    onchange="updateDetails()">
            </div>

            <div class="flex-row">
                <div class="form-group flex-col">
                    <label class="form-label">Duration</label>
                    <select class="form-input" id="duration" onchange="updateDetails()">
                        <option value="1 Day">1 Day</option>
                        <option value="2 Days / 1 Night">2 Days / 1 Night</option>
                        <option value="3 Days / 2 Nights" selected>3 Days / 2 Nights</option>
                        <option value="4+ Days">4+ Days</option>
                    </select>
                </div>
                <div class="form-group flex-col">
                    <label class="form-label">Preferred Month</label>
                    <select class="form-input" id="month" onchange="updateDetails()">
                        <option value="ASAP">As Soon As Possible</option>
                        <option value="May 2026">May 2026</option>
                        <option value="June 2026">June 2026</option>
                        <option value="July 2026">July 2026</option>
                        <option value="August 2026">August 2026</option>
                        <option value="September 2026">September 2026</option>
                    </select>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep(2)">Back</button>
                <button class="btn" onclick="nextStep(4)">Next: Activities</button>
            </div>
        </div>

        <!-- STEP 4: ACTIVITIES -->
        <div id="step-4" class="step-container">
            <h2>Curate Your Experience</h2>
            <p style="margin-bottom: 20px;">Select the activities to include in your package.</p>

            <div class="activity-grid" id="activities-container">
                <!-- Dynamically populated by renderActivities() -->
            </div>

            <div id="pricing-note" style="margin-top: 15px; font-size: 0.9rem; color: #666; font-style: italic;">
                * Pricing adjusts based on group size (High rate applies for groups > 8 due to additional staffing).
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep(3)">Back</button>
                <button class="btn" onclick="nextStep(5)">Review & Finish</button>
            </div>
        </div>

        <!-- STEP 5: SUMMARY -->
        <div id="step-5" class="step-container">
            <h2>Your Retreat Summary</h2>
            <p style="margin-bottom: 20px;">We've drafted a preliminary itinerary for you.</p>

            <div class="summary-box">
                <div class="summary-header">
                    <div class="summary-thumb" id="sum-thumb"></div>
                    <div>
                        <h3 id="sum-location" style="margin-bottom: 5px;">Location Name</h3>
                        <p style="margin-bottom: 5px;"><strong id="sum-guests">0</strong> Guests • <strong
                                id="sum-duration">--</strong></p>
                        <p style="font-size: 0.85rem; color: #666;" id="sum-month">Month</p>
                    </div>
                </div>

                <h4>Proposed Itinerary</h4>
                <div class="itinerary-container" id="itinerary-list">
                    <!-- JS Generated content -->
                </div>
            </div>

            <h3>Contact Details</h3>
            <div class="flex-row" style="margin-top: 15px;">
                <input type="text" class="form-input" placeholder="Full Name">
                <input type="email" class="form-input" placeholder="Email Address">
            </div>
            <div class="flex-row" style="margin-top: 15px;">
                <input type="text" class="form-input" placeholder="Company Name">
                <input type="tel" class="form-input" placeholder="Phone Number">
            </div>

            <button class="btn" style="width: 100%; margin-top: 30px;"
                onclick="alert('Thank you! Your retreat request has been sent to our team.')">Request Quote</button>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep(4)">Back</button>
            </div>
        </div>

    </div>

    <!-- MODAL STRUCTURE -->
    <div id="activity-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="modal-image-header" id="modal-img">
                <button class="modal-close-btn" onclick="closeModal()"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="modal-body">
                <h2 class="modal-title" id="modal-title">Activity Name</h2>
                <div class="modal-meta">
                    <span id="modal-category"><i class="fa-solid fa-tag"></i> Category</span>
                    <span id="modal-price"><i class="fa-solid fa-sterling-sign"></i> 0</span>
                </div>
                <div class="modal-description" id="modal-desc">
                    Description goes here...
                </div>
                <ul class="modal-features" id="modal-features"
                    style="margin-left: 20px; color: #555; font-size: 0.95rem; line-height: 1.8;">
                    <!-- Features populated by JS -->
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn" id="modal-action-btn" onclick="toggleFromModal()">Add to Retreat</button>
            </div>
        </div>
    </div>

    <script>
        const retreatData = {
            location: null,
            locationId: null, // 'bell', 'eastwood', 'oast'
            guests: 12,
            duration: '3 Days / 2 Nights',
            month: 'ASAP',
            activities: new Set()
        };

        // --- ACTIVITY DATA ---
        const activitiesDB = [
            // ESSENTIAL WORKSHOPS
            {
                id: 'yoga',
                name: 'Yoga Session',
                category: 'Essential',
                priceLow: 350,
                priceHigh: 450,
                image: 'Activities/yoga.jpeg',
                description: 'Professional yoga sessions designed specifically for corporate teams. Our certified yoga instructors create accessible sessions that accommodate all fitness levels, focusing on stress relief, flexibility, and mindfulness in our serene countryside setting.',
                features: [
                    '60-90 minute guided yoga sessions',
                    'All yoga equipment provided',
                    'Suitable for all abilities',
                    'Indoor/outdoor options available'
                ]
            },
            {
                id: 'circuit',
                name: 'Circuit Training',
                category: 'Essential',
                priceLow: 400,
                priceHigh: 550,
                image: 'Activities/Circuit_Training.jpeg',
                description: 'High-energy group fitness sessions that build teamwork through shared physical challenges. Our circuits combine strength, cardio, and functional movements in fun, competitive formats that encourage collaboration and mutual support.',
                features: [
                    'Team-based exercise stations',
                    'Competitive group challenges',
                    'Scalable intensity levels',
                    'Leadership development opportunities'
                ]
            },
            {
                id: 'running',
                name: 'Cross Country Run',
                category: 'Essential',
                priceLow: 350,
                priceHigh: 450,
                image: 'Activities/Country_running.jpeg',
                description: 'Guided running experiences through our beautiful countryside setting. Our qualified running coaches lead teams through scenic routes, teaching proper technique while building camaraderie through shared physical achievement and natural beauty.',
                features: [
                    'Professional running coach instruction',
                    'Scenic countryside routes',
                    'All fitness levels accommodated',
                    'Technique improvement focus'
                ]
            },
            {
                id: 'breathwork',
                name: 'Breathwork',
                category: 'Essential',
                priceLow: 350,
                priceHigh: 500,
                image: 'Activities/Breathwork.jpeg',
                description: 'Specialised breathwork sessions led by our expert practitioners. Learn powerful breathing techniques including Wim Hof method that reduce stress, increase energy levels, and improve mental clarity for enhanced workplace performance.',
                features: [
                    'Wim Hof breathing techniques',
                    'Stress reduction methods',
                    'Energy enhancement practices',
                    'Indoor/outdoor options available'
                ]
            },
            {
                id: 'icebath',
                name: 'Ice Bath Therapy',
                category: 'Essential',
                priceLow: 450,
                priceHigh: 650,
                image: 'Activities/Ice_bath.jpeg',
                description: 'Experience the transformative power of cold therapy with professional guidance. This unique wellness experience builds mental resilience, reduces stress, and creates powerful team bonding through shared challenge and overcome adversity together.',
                features: [
                    'Professional cold therapy guidance',
                    'Safety protocols & supervision',
                    'Mental resilience building',
                    'Team bonding through shared challenge'
                ]
            },
            {
                id: 'meditation',
                name: 'Meditation',
                category: 'Essential',
                priceLow: 350,
                priceHigh: 500,
                image: 'Activities/Meditation.jpeg',
                description: 'Guided mindfulness sessions that teach practical stress management techniques. Our experienced practitioners lead teams through breathing exercises, meditation practices, and mindfulness techniques that can be applied in the workplace for improved focus and wellbeing.',
                features: [
                    'Workplace stress reduction techniques',
                    'Guided breathing exercises',
                    'Mindful communication practices',
                    'Take-home wellbeing resources'
                ]
            },
            {
                id: 'pilates',
                name: 'Pilates Class',
                category: 'Essential',
                priceLow: 350,
                priceHigh: 450,
                image: 'Activities/pilates.jpeg',
                description: 'Professional pilates instruction focusing on core strength, posture improvement, and body alignment. Our qualified pilates instructors deliver sessions that enhance physical wellbeing while promoting mental focus and team cooperation.',
                features: [
                    'Core strength and stability focus',
                    'Posture improvement techniques',
                    'All pilates equipment provided',
                    'Beginner to advanced modifications'
                ]
            },

            // PREMIUM ADVENTURES
            {
                id: 'sheep',
                name: 'Sheep Herding',
                category: 'Premium',
                priceLow: 800,
                priceHigh: 1000,
                image: 'Activities/sheep.png',
                description: 'Our signature team building experience! Work alongside professional shepherds and their dogs to move sheep through the countryside. This unique activity develops leadership, communication, and strategic thinking while creating unforgettable memories.',
                features: [
                    'Professional shepherd instruction',
                    'Working with trained sheepdogs',
                    'Strategy and teamwork challenges',
                    'Champagne celebration included'
                ]
            },
            {
                id: 'orienteering',
                name: 'Orienteering',
                category: 'Premium',
                priceLow: 700,
                priceHigh: 900,
                image: 'Activities/orienting.jpeg',
                description: 'Navigate our countryside using maps and teamwork skills. Groups are given coordinates and challenges to complete while finding their way to the final celebration point. Builds problem-solving, leadership, and communication skills.',
                features: [
                    'Professional printed maps provided',
                    'Strategic checkpoint challenges',
                    'Team communication exercises',
                    'Celebration drinks at finish point'
                ]
            },
            {
                id: 'haybale',
                name: 'Hay Bale Racing',
                category: 'Premium',
                priceLow: 500,
                priceHigh: 700,
                image: 'Activities/hayball.webp',
                description: 'A uniquely fun countryside experience where teams compete in hay bale pushing races and challenges. This seasonal activity combines physical exercise with laughter, creating memorable team bonding moments in our authentic farm setting.',
                features: [
                    'Seasonal availability (spring/summer)',
                    'Team racing competitions',
                    'Farm-authentic experience',
                    'Prize ceremonies and celebrations'
                ]
            },
            {
                id: 'archery',
                name: 'Archery & Axe',
                category: 'Premium',
                priceLow: 600,
                priceHigh: 800,
                image: 'Activities/archery.webp',
                description: 'Experience the thrill of traditional target sports with professional instruction in archery and axe throwing. These skill-based activities promote focus, patience, and friendly competition while providing unique team bonding experiences.',
                features: [
                    'Professional safety instruction',
                    'All equipment and targets provided',
                    'Individual and team competitions',
                    'Axe throwing: 18+ adults only'
                ]
            },
            {
                id: 'frisbee',
                name: 'Frisbee Golf',
                category: 'Premium',
                priceLow: 500,
                priceHigh: 700,
                image: 'Activities/frisbee.jpeg',
                description: 'Combine classic British sport with modern team activities. Our frisbee golf course uses the natural terrain, while rounders tournaments create friendly competition. Both activities are designed to break down hierarchies and encourage playful interaction.',
                features: [
                    'Multi-terrain frisbee golf course',
                    'Traditional rounders tournaments',
                    'All equipment provided',
                    'Prize ceremonies and celebrations'
                ]
            },
            {
                id: 'cocktails',
                name: 'Cocktails/Mocktails',
                category: 'Premium',
                priceLow: 700,
                priceHigh: 1000,
                image: 'Activities/cocktail.webp',
                description: 'Learn the art of creating delicious cocktails and health-conscious mocktails. Our mixology experts teach teams to craft beautiful drinks using fresh ingredients, herbs, and superfoods - perfect for evening entertainment.',
                features: [
                    'Professional mixology instruction',
                    'Superfood and herb ingredients',
                    'Recipe cards to take home',
                    'Team cocktail competitions'
                ]
            },
            {
                id: 'foraging',
                name: 'Mushroom Foraging',
                category: 'Premium',
                priceLow: 600,
                priceHigh: 800,
                image: 'Activities/mushroom.webp',
                description: 'Explore our 30-acre grounds with expert foragers who teach teams to identify edible mushrooms, berries, and nuts. This educational adventure combines learning with team bonding while connecting corporate groups with the natural world.',
                features: [
                    'Expert forager guidance',
                    'Seasonal produce identification (Sept-Nov)',
                    'Sustainable harvesting practices',
                    'Recipe cards and preparation tips'
                ]
            }
        ];

        function getPrice(act) {
            const guestCount = parseInt(retreatData.guests) || 0;
            return guestCount > 8 ? act.priceHigh : act.priceLow;
        }

        function renderActivities() {
            const container = document.getElementById('activities-container');
            container.innerHTML = '';

            // Group by category for better UX? Or just flat list. 
            // Flat list but ordered (Essentials first, then Premium) as per data array.

            activitiesDB.forEach(act => {
                const currentPrice = getPrice(act);
                const isSelected = retreatData.activities.has(act.id);

                const card = document.createElement('div');
                card.className = `activity-card ${isSelected ? 'selected' : ''}`;
                card.onclick = () => openModal(act.id); // CHANGED: Open modal on click

                card.innerHTML = `
                    <div class="activity-img-placeholder" style="background-image: url('${act.image}');">
                        <div class="activity-overlay"><i class="fa-solid fa-check"></i></div>
                    </div>
                    <div class="activity-content">
                        <span>${act.name}</span>
                        <div style="font-size: 0.8rem; color: #666; margin-top: 4px;">£${currentPrice} <i class="fa-solid fa-circle-info" style="margin-left:5px; color:var(--color-primary);"></i></div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // --- MODAL LOGIC ---
        let currentModalActivityId = null;

        function openModal(id) {
            currentModalActivityId = id;
            const act = activitiesDB.find(a => a.id === id);
            if (!act) return;

            // Populate Modal
            document.getElementById('modal-img').style.backgroundImage = `url('${act.image}')`;
            document.getElementById('modal-title').innerText = act.name;
            document.getElementById('modal-category').innerText = act.category;
            document.getElementById('modal-price').innerText = "£" + getPrice(act);
            document.getElementById('modal-desc').innerText = act.description || "";

            // Populate Features
            const featureList = document.getElementById('modal-features');
            featureList.innerHTML = '';
            if (act.features && act.features.length > 0) {
                act.features.forEach(f => {
                    const li = document.createElement('li');
                    li.innerText = f;
                    featureList.appendChild(li);
                });
            }
            const btn = document.getElementById('modal-action-btn');
            if (retreatData.activities.has(id)) {
                btn.innerText = "Remove from Retreat";
                btn.classList.add('btn-secondary');
                btn.style.backgroundColor = 'transparent';
                btn.style.color = 'var(--color-primary)';
                btn.style.border = '2px solid var(--color-primary)';
            } else {
                btn.innerText = "Add to Retreat";
                btn.classList.remove('btn-secondary');
                btn.style.backgroundColor = 'var(--color-primary)';
                btn.style.color = 'white';
                btn.style.border = 'none';
            }

            // Show Modal
            const overlay = document.getElementById('activity-modal');
            overlay.style.display = 'flex';
            // Small delay to allow display flex to apply before opacity transition
            setTimeout(() => overlay.classList.add('active'), 10);
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeModal(event) {
            // If triggered by click on overlay (event defined), check target
            if (event && event.target !== event.currentTarget) return;

            const overlay = document.getElementById('activity-modal');
            overlay.classList.remove('active');
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
            document.body.style.overflow = '';
        }

        function toggleFromModal() {
            if (!currentModalActivityId) return;
            toggleActivity(currentModalActivityId);
            closeModal();
        }

        // --- CAROUSEL LOGIC ---
        // --- EMBED COMMUNICATION LAYER ---
        function notifyParent(type, data = {}) {
            if (window.parent !== window) {
                window.parent.postMessage({ type, data }, '*');
            }
        }

        function closeEmbeddedModal() {
            notifyParent('CLOSE_MODAL');
        }

        // Initialize embed-specific UI
        window.addEventListener('DOMContentLoaded', () => {
            if (window.parent !== window) {
                document.body.classList.add('is-embedded');
            }
        });

        // Initialize carousels
        const carousels = {
            bell: 0,
            eastwood: 0,
            oast: 0
        };

        function initCarousels() {
            ['bell', 'eastwood', 'oast'].forEach(id => {
                const nav = document.getElementById('nav-' + id);
                nav.innerHTML = '';
                for (let i = 0; i < 4; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'carousel-dot ' + (i === 0 ? 'active' : '');
                    dot.onclick = (e) => { e.stopPropagation(); setSlide(id, i); };
                    nav.appendChild(dot);
                }
            });
        }

        function moveSlide(event, id, direction) {
            event.stopPropagation();
            let current = carousels[id];
            const next = (current + direction + 4) % 4;
            setSlide(id, next);
        }

        function setSlide(id, index) {
            carousels[id] = index;
            const container = document.getElementById('card-' + id).querySelector('.carousel-container');
            const slides = container.querySelectorAll('.carousel-slide');
            const dots = container.querySelectorAll('.carousel-dot');

            slides.forEach((s, i) => s.classList.toggle('active', i === index));
            dots.forEach((d, i) => d.classList.toggle('active', i === index));
        }

        // --- FUNNEL LOGIC ---
        function nextStep(stepNumber) {
            if (stepNumber === 3 && !retreatData.location) {
                return; // Button disabled anyway
            }

            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            document.getElementById('step-' + stepNumber).classList.add('active');

            if (stepNumber === 4) renderActivities();
            if (stepNumber === 5) generateItinerary();
        }

        function prevStep(stepNumber) {
            document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
            document.getElementById('step-' + stepNumber).classList.add('active');
        }

        function handleCardClick(element, locationName) {
            // Determine ID
            let id = 'bell';
            if (locationName.includes('Eastwood')) id = 'eastwood';
            if (locationName.includes('Oastbrook')) id = 'oast';

            // Visual selection
            document.querySelectorAll('.card-option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');

            // Data update
            retreatData.location = locationName;
            retreatData.locationId = id;

            // Enable Next
            const btn = document.getElementById('btn-loc-next');
            btn.removeAttribute('disabled');
            btn.innerHTML = "Next: Details";
        }

        function updateDetails() {
            retreatData.guests = document.getElementById('guest-count').value || 12;
            retreatData.duration = document.getElementById('duration').value;
            retreatData.month = document.getElementById('month').value;

            // Re-render activities if we are on that step (or just always) to update prices
            renderActivities();
        }

        function toggleActivity(id) {
            if (retreatData.activities.has(id)) {
                retreatData.activities.delete(id);
            } else {
                retreatData.activities.add(id);
            }
            renderActivities();
        }

        // --- ITINERARY GENERATOR ---
        function generateItinerary() {
            // Update Header
            document.getElementById('sum-location').textContent = retreatData.location;
            document.getElementById('sum-guests').textContent = retreatData.guests;
            document.getElementById('sum-duration').textContent = retreatData.duration;
            document.getElementById('sum-month').textContent = retreatData.month;

            // Set Thumbnail (Using first image of selected location)
            const thumbUrl = document.querySelector(`#card-${retreatData.locationId} .carousel-slide.active`).style.backgroundImage;
            document.getElementById('sum-thumb').style.backgroundImage = thumbUrl;

            // Generate Logic
            const container = document.getElementById('itinerary-list');
            container.innerHTML = '';

            let days = 1;
            if (retreatData.duration.startsWith('2')) days = 2;
            if (retreatData.duration.startsWith('3')) days = 3;
            if (retreatData.duration.startsWith('4')) days = 4;

            // Convert Set to Array of Objects for the itinerary
            const selectedActs = activitiesDB.filter(a => retreatData.activities.has(a.id));
            const activitiesQueue = selectedActs.map(a => a.name);

            // Calculate Cost
            let totalActivityCost = 0;
            selectedActs.forEach(act => {
                totalActivityCost += getPrice(act);
            });

            const schedule = [];

            for (let i = 1; i <= days; i++) {
                let dayPlan = `<strong>Day ${i}:</strong> `;
                let events = [];

                if (i === 1) events.push("Arrival & Welcome Lunch");
                else events.push("Healthy Breakfast");

                // Distribute activities
                if (activitiesQueue.length > 0) events.push(activitiesQueue.shift());
                events.push("Lunch Break");
                if (activitiesQueue.length > 0 && i < days) events.push(activitiesQueue.shift());

                if (i === days) events.push("Departure");
                else events.push("Farm-to-Table Dinner");

                schedule.push({ day: i, events: events });
            }

            // Render Itinerary
            schedule.forEach(day => {
                const div = document.createElement('div');
                div.className = 'day-row';
                div.innerHTML = `
                    <div class="day-title">Day ${day.day}</div>
                    <div class="day-content">${day.events.join(' • ')}</div>
                `;
                container.appendChild(div);
            });

            // Add note if leftover activities
            if (activitiesQueue.length > 0) {
                const note = document.createElement('div');
                note.style.fontSize = '0.8rem';
                note.style.fontStyle = 'italic';
                note.style.marginTop = '10px';
                note.textContent = `+ Also included: ${activitiesQueue.join(', ')}`;
                container.appendChild(note);
            }

            // Cost Summary
            const costDiv = document.createElement('div');
            costDiv.style.marginTop = '20px';
            costDiv.style.paddingTop = '15px';
            costDiv.style.borderTop = '1px solid #ccc';
            costDiv.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong>Estimated Activity Cost:</strong>
                    <span style="font-size:1.1rem; color:var(--color-primary);">£${totalActivityCost.toLocaleString()}</span>
                </div>
                <div style="font-size:0.8rem; color:#666; margin-top:5px;">(Based on ${retreatData.guests} participants. Venue fees calculated separately.)</div>
            `;
            container.appendChild(costDiv);

            if (retreatData.activities.size === 0) {
                container.innerHTML = '<div style="padding:10px; font-style:italic;">No specific activities selected. We will design a relaxation focused itinerary.</div>';
            }
        }

        // Init
        initCarousels();
    </script>
</body>
<div id="venue-modal-container">
    <!-- Venue Modal Styles -->
    <style>
        /* Core Variables & Resets */
        :root {
            --venue-primary: #2d5016;
            --venue-primary-dark: #1e3a0f;
            --venue-text: #333333;
            --venue-text-light: #666666;
            --venue-bg: #ffffff;
            --venue-bg-alt: #f9f9f9;
        }

        #venue-modal-container * {
            box-sizing: border-box;
        }

        /* Modal Overlay */
        .venue-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
        }

        .venue-modal-overlay.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* Modal Content Wrapper */
        .venue-modal-content {
            background: white;
            width: 100%;
            max-width: 1200px;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            animation: modalSlideUp 0.4s ease-out;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Close Button */
        .venue-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .venue-modal-close:hover {
            transform: scale(1.1);
        }

        /* --- COPY OF VENUE DETAIL STYLES (Scoped) --- */

        /* Hero Section */
        .venue-hero {
            position: relative;
            width: 100%;
            height: 60vh;
            min-height: 400px;
            background: #1a1a1a;
        }

        .hero-carousel {
            width: 100%;
            height: 100%;
        }

        .hero-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
        }

        .hero-slide.active {
            opacity: 1;
        }

        .hero-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.8);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 10;
        }

        .carousel-nav:hover {
            background: white;
        }

        .carousel-nav.prev {
            left: 20px;
        }

        .carousel-nav.next {
            right: 20px;
        }

        .hero-info-card {
            position: absolute;
            bottom: 40px;
            left: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .hero-info-card h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
            color: var(--venue-text);
            font-family: 'Playfair Display', serif;
        }

        .hero-info-card .tagline {
            margin: 0 0 15px 0;
            font-size: 16px;
            color: var(--venue-text-light);
            font-style: italic;
        }

        .hero-info-card .pricing {
            font-size: 20px;
            font-weight: 700;
            color: var(--venue-primary);
        }

        /* Quick Facts */
        .quick-facts-bar {
            padding: 30px 40px;
            background: var(--venue-bg-alt);
            border-bottom: 1px solid #eee;
        }

        .quick-facts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
        }

        .quick-fact {
            text-align: center;
        }

        .quick-fact-icon img {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .quick-fact-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
            margin-bottom: 4px;
        }

        .quick-fact-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--venue-text);
        }

        /* Content Layout */
        .venue-content {
            padding: 40px;
        }

        .venue-section {
            margin-bottom: 60px;
        }

        .venue-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: var(--venue-primary);
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        /* Grid Layouts */
        .accommodation-grid,
        .activities-grid,
        .facilities-grid {
            display: grid;
            gap: 24px;
        }

        .accommodation-grid {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .activities-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }

        /* Cards */
        .info-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 24px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .info-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .info-card h3 {
            color: var(--venue-primary);
            margin-top: 0;
            font-size: 18px;
        }

        .info-card p {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }

        /* Lists */
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 15px 0 0 0;
        }

        .feature-list li {
            padding-left: 20px;
            position: relative;
            font-size: 13px;
            color: #666;
            margin-bottom: 6px;
        }

        .feature-list li::before {
            content: "•";
            color: var(--venue-primary);
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        /* Booking Bar */
        .booking-bar {
            background: var(--venue-bg-alt);
            padding: 20px 40px;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            bottom: 0;
            z-index: 50;
        }

        .action-btn {
            background: var(--venue-primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .action-btn:hover {
            background: var(--venue-primary-dark);
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .venue-modal-overlay {
                padding: 0;
            }

            .venue-modal-content {
                border-radius: 0;
                margin: 0;
                height: 100vh;
                max-height: 100vh;
                overflow-y: auto;
            }

            .venue-hero {
                height: 40vh;
                min-height: 300px;
            }

            .hero-info-card {
                position: static;
                margin: -60px 20px 0 20px;
                width: auto;
                max-width: none;
            }

            .quick-facts-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .venue-content {
                padding: 20px;
            }

            .booking-bar {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .booking-bar-info {
                margin-bottom: 10px;
            }

            .action-btn {
                width: 100%;
            }
        }
    </style>

    <!-- Modal HTML Structure -->
    <div id="venueModal" class="venue-modal-overlay">
        <div class="venue-modal-content">
            <button class="venue-modal-close" onclick="closeVenueModal()">×</button>

            <div id="venueModalBody">
                <!-- Dynamic Content Injected Here -->
            </div>

            <div class="booking-bar">
                <div class="booking-bar-info">
                    <h3 id="modalBookingTitle" style="margin:0; color:var(--venue-primary);">Ready to book?</h3>
                    <div id="modalBookingPrice" style="font-size:14px; color:#666;"></div>
                </div>
                <button class="action-btn" onclick="selectVenueAndClose()">Select This Venue</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- VENUE DATA (Condensed) ---
        const embedVenuesDB = {
            bell: {
                name: 'The Bell in Ticehurst',
                tagline: 'Quirky 16th Century Coaching Inn',
                capacity: 'Up to 32 guests',
                price: 'From £150 per room',
                description: 'In the quintessentially English village of Ticehurst, discover the storybook charm of The Bell. A creative paradise blending old and new.',
                images: [
                    'Retreat Images/The Bell/The Bell 1.webp',
                    'Retreat Images/The Bell/The Bell 2.jpg',
                    'Retreat Images/The Bell/The Bell 3 .avif',
                    'https://www.thebellinticehurst.com/wp-content/uploads/2022/01/The-Bell-Rooms-Banner-Image-02-scaled.jpg',
                    'https://www.thebellinticehurst.com/wp-content/uploads/2024/02/The-Bell-Events-Banner-Image-02-scaled.jpg',
                    'https://www.thebellinticehurst.com/wp-content/uploads/2020/11/The-Bell-Benefit-of-Doubt2.jpg',
                    'https://www.thebellinticehurst.com/wp-content/uploads/2023/08/The-Bell-The-Moon-Wild3-scaled.jpg'
                ],
                facts: [
                    { icon: 'Retreat Images/Icons/icon_capacity.png', label: 'Capacity', value: '32 Guests' },
                    { icon: 'Retreat Images/Icons/icon_accommodation.png', label: 'Rooms', value: '16 Rooms' },
                    { icon: 'Retreat Images/Icons/icon_rating.png', label: 'Rating', value: '5-Star AA' }
                ],
                accommodation: [
                    { name: 'Hotel Bedrooms', desc: '7 Eccentric rooms over the pub', features: ['Handmade mattresses', 'Copper baths'] },
                    { name: 'Garden Lodges', desc: '4 Fantastical lodges with fire pits', features: ['Private patios', 'Wood burners'] }
                ],
                activities: ['Analogue Adventures', 'Wine Masterclass', 'Creative Workshops']
            },
            oastbrook: {
                name: 'Oastbrook Estate',
                tagline: 'Luxury Vineyard Retreat',
                capacity: 'Up to 20 guests',
                price: 'From £200 per unit',
                description: 'Set in the heart of Rother Valley, a working vineyard combining rustic charm with modern luxury lodges and glamping.',
                images: [
                    'Retreat Images/Oastbrook/Oastbrook 1.avif',
                    'Retreat Images/Oastbrook/Oastbrook 2.webp',
                    'Retreat Images/Oastbrook/Oastbrook 3.webp',
                    'https://oastbrook.com/wp-content/uploads/2023/09/1546572-SX93820-20Exterior-1024x683.jpg',
                    'https://oastbrook.com/wp-content/uploads/2023/09/Outside-1024x856.jpg',
                    'https://oastbrook.com/wp-content/uploads/2023/09/Hot-Tub-1024x659.jpg',
                    'https://oastbrook.com/wp-content/uploads/2023/09/Master-Bedroom-1-1024x659.jpg'
                ],
                facts: [
                    { icon: 'Retreat Images/Icons/icon_capacity.png', label: 'Capacity', value: '20 Guests' },
                    { icon: 'Retreat Images/Icons/icon_dining.png', label: 'Dining', value: 'Vineyard' },
                    { icon: 'Retreat Images/Icons/icon_rating.png', label: 'Awards', value: 'Nat Geo' }
                ],
                accommodation: [
                    { name: 'Vineyard Hollow', desc: 'Earth-sheltered luxury', features: ['Hot tub', 'Valley views'] },
                    { name: 'Glamping Tents', desc: '8 Luxury bell tents', features: ['King beds', 'Fire pits'] }
                ],
                activities: ['Vineyard Tours', 'Tasting Room', 'Archery']
            },
            eastwood: {
                name: 'Eastwood Observatory',
                tagline: 'Exclusive 32-Acre Estate',
                capacity: 'Up to 24 guests',
                price: 'From £3500 exclusive use',
                description: 'Idyllic rural setting with unparalleled beauty. Exclusive use of the entire estate, swimming pool, and science center.',
                images: [
                    'Retreat Images/Eastwood/Eastwood 1.webp',
                    'Retreat Images/Eastwood/Eastwood 2.webp',
                    'Retreat Images/Eastwood/Eastwood 4.webp',
                    'https://www.eastwoodobservatory.co.uk/wp-content/uploads/2022/06/2022-06-11-Eastwood-House-Ed-Ovenden-117-580x420.jpg',
                    'https://www.eastwoodobservatory.co.uk/wp-content/uploads/2023/06/shooting-at-eastwood-scaled.jpg',
                    'https://www.eastwoodobservatory.co.uk/wp-content/uploads/2022/06/2022-06-11-Eastwood-House-Ed-Ovenden-170-e1656086748141.jpg',
                    'https://www.eastwoodobservatory.co.uk/wp-content/uploads/2022/06/2022-06-10-Eastwood-House-Ed-Ovenden-014-e1656087036743.jpg'
                ],
                facts: [
                    { icon: 'Retreat Images/Icons/icon_capacity.png', label: 'Capacity', value: '24+ Guests' },
                    { icon: 'Retreat Images/Icons/icon_meeting.png', label: 'Estate', value: '32 Acres' },
                    { icon: 'Retreat Images/Icons/icon_activities.png', label: 'Activities', value: 'Science' }
                ],
                accommodation: [
                    { name: 'Main House', desc: '13 Bedrooms with Georgian proportions', features: ['En-suite bathrooms', 'Estate views'] }
                ],
                activities: ['Stargazing', 'Clay Shooting', 'Mobile Climbing Wall']
            }
        };

        let currentModalVenueId = null;

        // Open Modal Function
        function openVenueDetail(venueId) {
            const venue = embedVenuesDB[venueId];
            if (!venue) return console.error('Venue not found:', venueId);

            currentModalVenueId = venueId;
            const modalBody = document.getElementById('venueModalBody');
            const priceLabel = document.getElementById('modalBookingPrice');

            priceLabel.textContent = venue.price;

            // Build HTML
            let html = `
                <div class="venue-hero">
                    <img src="${venue.images[0]}" style="width:100%; height:100%; object-fit:cover;">
                    <div class="hero-info-card">
                        <h1>${venue.name}</h1>
                        <p class="tagline">${venue.tagline}</p>
                        <p class="pricing">${venue.price}</p>
                    </div>
                </div>
                
                <div class="quick-facts-bar">
                    <div class="quick-facts-grid">
                        ${venue.facts.map(f => `
                            <div class="quick-fact">
                                <div class="quick-fact-icon"><img src="${f.icon}"></div>
                                <span class="quick-fact-label">${f.label}</span>
                                <span class="quick-fact-value">${f.value}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="venue-content">
                    <section class="venue-section">
                        <h2>About</h2>
                        <p style="font-size:16px; line-height:1.6;">${venue.description}</p>
                    </section>

                    <section class="venue-section">
                        <h2>Gallery</h2>
                        <div class="venue-gallery-grid">
                            ${venue.images.map(img => `
                                <div class="venue-gallery-item" onclick="window.open('${img}', '_blank')">
                                    <img src="${img}" loading="lazy">
                                </div>
                            `).join('')}
                        </div>
                    </section>
                    
                    <section class="venue-section">
                        <h2>Accommodation</h2>
                        <div class="accommodation-grid">
                            ${venue.accommodation.map(a => `
                                <div class="info-card">
                                    <h3>${a.name}</h3>
                                    <p>${a.desc}</p>
                                    <ul class="feature-list">
                                        ${a.features.map(feat => `<li>${feat}</li>`).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>
                    </section>

                     <section class="venue-section">
                        <h2>Activities & Highlights</h2>
                        <div class="activities-grid">
                            ${venue.activities.map(act => `
                                <div class="info-card" style="text-align:center;">
                                    <h3 style="font-size:16px;">${act}</h3>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                </div>
            `;

            modalBody.innerHTML = html;
            document.getElementById('venueModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        // Close Modal Function
        function closeVenueModal() {
            document.getElementById('venueModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Selection Action
        function selectVenueAndClose() {
            // Check if we are in the retreat builder context
            if (typeof handleCardClick === 'function') {
                // Simulate selection logic if needed, or redirect
                const cardMap = { 'bell': 'card-bell', 'oastbrook': 'card-oast', 'eastwood': 'card-eastwood' };
                const nameMap = { 'bell': 'The Bell in Ticehurst', 'oastbrook': 'Oastbrook Vineyards', 'eastwood': 'Eastwood Observatory' };

                const card = document.getElementById(cardMap[currentModalVenueId]);
                if (card) {
                    handleCardClick(card, nameMap[currentModalVenueId]);
                    closeVenueModal();
                    // Scroll to next step or similar
                    document.getElementById('step-2').scrollIntoView({ behavior: 'smooth' });
                }
            } else {
                alert('Venue Selected: ' + currentModalVenueId);
                closeVenueModal();
            }
        }

        // Close on clicking outside
        document.getElementById('venueModal').addEventListener('click', function (e) {
            if (e.target === this) closeVenueModal();
        });
    </script>
</div>
</body>

</html>